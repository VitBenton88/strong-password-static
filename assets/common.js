"use strict";$(".field_group.sortable").each(function(){var e=document.getElementById($(this).find("tbody").attr("id"));new Sortable(e,{handle:".existent_repeater",ghostClass:"ui-state-highlight",onUpdate:function(e){for(var a=$(e.to).children("tr"),t=[],i=[],s=0;s<a.length;s++){var n=$(a[s]),l=parseInt(n.data("position"));t.push(n.attr("id")),i.push(l)}if(!t||!i)return!1;$.ajax({data:{_ids:t,positions:i},type:"PUT",url:"/fields/repeater/position/update",success:function(){relabelTable(a)},error:function(e){console.error(e)}})}})});var relabelTable=function(e){return e&&e.each(function(e){$(this).find("th").text(e+1)}),!1},sendFile=function(e){var a=new FormData;a.append("file",e),$.ajax({data:a,type:"POST",url:"/editorimageuploads",cache:!1,contentType:!1,processData:!1,success:function(e){var a=e.fileName,t=e.filePath;$(".summernote-editor").summernote("insertImage",t,a)},error:function(e){console.error(e)}})},menuPositionUpdate=function(e){var a=$(".alert.menu-pos-alert");a&&a.fadeOut(),$(".page-body").before('<div class="alert alert-success alert-dismissible fade show menu-pos-alert" role="alert">\n        <strong>Success: </strong> '.concat(e,' position update.\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n        </button>\n        </div>'))};$(function(){$(".summernote-editor").summernote({minHeight:500,callbacks:{onImageUpload:function(e,a,t){sendFile(e[0],a,t)}}})}),$("#media-select-search").keyup(function(){var e=$(this).val();if(e.length<4)return!1;$.ajax({type:"GET",url:"/api/media/search/".concat(e),success:function(e){if($(".analog-modal.media-select .media-grid").empty(),e.length)return e.forEach(function(e,a){$(".media-grid").append('<div id="media-'.concat(a,'" data-id="').concat(e._id,'" data-path="').concat(e.path,'" class="col-4 col-md-3 col-lg-2 media-grid-item"\n                        style="background-image: url(\'').concat(e.path,"')\"></div>"))}),$(".analog-modal").addClass("active");$(".media-grid").append('<div class="col-12"><h4>No media found.</h4></div>')},error:function(e){$(".custom-fields-notifications .alert").remove(),$(".custom-fields-notifications").append('<div class="alert alert-warning alert-dismissible fade show" role="alert">\n                <strong>Error: </strong> '.concat(e.message,'\n                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n                </button>\n                </div>'))}})}),$(".cms-menu .nav-item.nav-has-submenu").hover(function(){var e=$(this);return!e.hasClass("current")&&e.addClass("expanded")},function(){var e=$(this);return!e.hasClass("current")&&e.removeClass("expanded")}),$("body").on("click",".analog_media_select_remove",function(){return $(this).hide().siblings(".analog_media_select_img").attr("src","").hide(),!1}),$("body").on("click",".analog_media_select",function(){var e=$(this),a=e.siblings(".analog_media_select_input").attr("id"),t=e.siblings(".analog_media_select_img").attr("id");$("body").addClass("analog_media_select"),$(".analog-modal.media-select").attr("data-inputtarget","#"+a),$(".analog-modal.media-select").attr("data-imgtarget","#"+t)}),$(".cancel_edit_repeater_field, .edit_repeater_modal_close").click(function(){$(".existent_repeater").removeClass("currently_updating"),$("body").removeClass("editing_repeater_field")}),$(".save_edit_repeater_field").click(function(){var o=$("#edit_repeater_modal .modal-body").find(".field"),c=[],u=new FormData,m=!1;return!!o&&(u.append("owner",window.location.href.split("/").pop().trim()),o.each(function(e,a){var t=$(a),i=t.val(),s="file"==t.attr("type"),n=!1;if(s){var l=t.siblings(".analog_media_select_input").val();i=t[0].files[0],l&&(i=l,n=!0)}if(!i&&t.hasClass("required"))return t.addClass("is-invalid"),!(m=!0);if(i){var d=$(".existent_repeater.currently_updating").find('[data-type="'+t.attr("id")+'"]').attr("id"),r=d+"_field";n?u.append(d+"_media_select",i):(u.append(r,i),s&&u.append(d+"_fieldtype","upload")),c.push(d)}o.removeClass("is-invalid")}),m||(u.append("field_index",c),$.ajax({type:"PUT",url:"/fields/repeater/update",data:u,contentType:!1,processData:!1,success:function(e){for(var a=0;a<e.length;a++){var t=e[a],i=t.value,s=$(".existent_repeater.currently_updating").find("#"+t._id);s.hasClass("file")?s.find("img.field-upload-thumb").attr("src",i).show():s.find("span").html(i)}$(".existent_repeater.currently_updating").addClass("bg-success"),$(".cancel_edit_repeater_field").click(),setTimeout(function(){$(".existent_repeater").removeClass("bg-success")},500)},error:function(e){console.error(e)}})),!1)}),$("body").on("click",".edit_repeater_field",function(){var e=$(this),a=$(e.data("group")).find(".repeater_form").clone(),l=$("#edit_repeater_modal .modal-body");$("body").addClass("editing_repeater_field"),l.html(a),e.closest(".existent_repeater").addClass("currently_updating").find(".existent_repeater_field .value").each(function(){var e=$(this),a=e.attr("id"),t=e.data("type"),i=e.data("value");if(e.hasClass("upload")){var s=e.find(".field-upload-thumb").attr("src"),n=e.find(".field-upload-thumb").data("id");return s&&l.find("#media_select_img_"+t).attr("src",s).show().siblings(".analog_media_select_remove").removeClass("analog_media_select_remove").addClass("field-upload-del").attr("data-id",a).show().siblings("input.upload, .analog_media_select, small").hide().siblings(".analog_media_select_input").val(n),!0}t&&i&&l.find("#"+t).val(i)})}),$("body").on("click",".field-upload-del",function(){var e=$(this),a=e.data("id");return a&&window.confirm("Are you sure you want to remove this media?")&&a&&$.ajax({type:"DELETE",url:"/field/file/delete/"+a,success:function(){$("body").hasClass("editing_repeater_field")?(e.hide().siblings(".analog_media_select_img").hide().siblings(".analog_media_select_input").val("").siblings("input.upload, .analog_media_select, small").show(),$(".existent_repeater.currently_updating").find("#"+a+" img").hide().attr("src","")):(e.siblings(".field-upload-thumb").remove(),e.remove())},error:function(e){window.alert(e.message)}}),!1}),$(".add_repeater_field").click(function(){var e=$(this),l=$(e.data("parent")),d=$(e.data("table")),r='<tr><th scope="row">'+(d.find("tbody tr").length+1)+"</th><td>",o="",c="",u=!1,m=l.find(".field_wrap .field"),p=new FormData,f=[],g=[];return p.append("_id",window.location.href.split("/").pop().trim()),m.each(function(e,a){var t=$(a),i="file"==t.attr("type"),s=i?t[0].files[0]:t.val(),n=t.data("title");if(!n)return!0;if(""==s&&t.hasClass("required"))return t.addClass("is-invalid"),!(u=!0);for(var l=t.attr("id").replace("field_",""),d=["_field","_type","_fieldtype","_group"],r=0;r<d.length;r++){var o=l+d[r],c=r?$("#"+o).data("value"):s;p.append(o,c)}if(i){o=l+"_media_select";(c=$("#"+o).val())&&p.append(o,c)}f.push(l),m.removeClass("is-invalid"),g.push(n)}),u||(p.append("field_index",f),$.ajax({type:"POST",url:"/fields/repeater/create",data:p,contentType:!1,processData:!1,success:function(e){if(e){for(var a=[],t=0;t<e.length;t++){var i=e[t],s=i.value,n=i._id;i.file&&(s='<img class="field-upload-thumb sm" src="'+s+'" alt="repeater field file thumbnail">'),o+='<p id="'+n+'"><strong>'+g[t]+": </strong>"+s+"</p>",a.push(n)}c='</td><td><button type="button" class="btn btn-info btn-sm edit_repeater_field">Edit</button></td><td><button type="button" class="btn btn-danger btn-sm delete_repeater_field" data-ids="'+a.join()+'">Delete</button></td></tr>',d.css("display","table").find("tbody").append(r+o+c),m.val(""),l.find(".analog_media_select_input").val("").siblings(".analog_media_select_img").attr("src","").hide().siblings(".admin_hidden_ui_ele").hide()}},error:function(e){console.error(e)}})),!1}),$("body").on("click",".delete_repeater_field",function(){var e=$(this),a=e.closest("table"),t=e.data("id"),i=a.find("tbody").children("tr");return window.confirm("Are you sure you want to delete this repeater field?")&&(e.prop("disabled",!0),t&&$.ajax({type:"POST",url:"/fields/repeater/delete",data:{_id:t},success:function(){e.closest("tr").fadeOut("fast",function(){1==i.length&&a.css("display","none"),$(this).remove(),relabelTable(a.find("tbody").children("tr"))})},error:function(e){console.error(e)}})),!1}),$("body").on("mouseup",".analog-modal.media-select.active button.select",function(){var e=$(".analog-modal.media-select.active .media-grid-item.selected"),a=$("body").hasClass("editing_repeater_field");if(!e.length)return!1;var t=e.data("id"),i=e.data("path");if($("body").hasClass("analog_media_select")||a){var s=$(".analog-modal.media-select").data("inputtarget"),n=$(".analog-modal.media-select").data("imgtarget");return a?($("#edit_repeater_modal").find(s).val(t),$("#edit_repeater_modal").find(n).show().attr("src",i).siblings("input[type=file]").val("").siblings(".analog_media_select_remove").show(),!1):($(s).val(t),$(n).show().attr("src",i).siblings("input[type=file]").val("").siblings(".analog_media_select_remove").show(),$("body").removeClass("analog_media_select"),!1)}$(".image-upload-thumb").removeClass("no-image").addClass("image-exists").css("background-image","url('".concat(i,"')")).empty(),$("input#_image").val(t),$(".analog-modal .media-grid").empty()}),$("body").on("mouseup",".analog-modal.media-select.active button.dismiss",function(){$(".analog-modal .media-grid").empty(),$("body").removeClass("analog_media_select")}),$("body").on("click",".analog-modal.media-select.active .media-grid-item",function(){var e=$(this);return e.hasClass("selected")?e.removeClass("selected"):($(".media-grid-item").removeClass("selected"),e.addClass("selected")),!1}),$("body").on("click",".image-upload-thumb, .analog_media_select",function(){$.ajax({type:"GET",url:"/api/media/",success:function(e){if($(".analog-modal.media-select .media-grid").empty(),e.length)return e.forEach(function(e,a){$(".media-grid").append('<div id="media-'.concat(a,'" data-id="').concat(e._id,'" data-path="').concat(e.path,'" title="').concat(e.fileName,'" class="col-4 col-md-3 col-lg-2 media-grid-item"\n                        style="background-image: url(\'').concat(e.path,"')\"></div>"))}),$(".analog-modal").addClass("active");$(".analog-modal").addClass("active"),$(".media-grid").append('<div class="col-12"><h4>No media found.</h4></div>')},error:function(e){console.error(e),$(".custom-fields-notifications .alert").remove(),$(".custom-fields-notifications").append('<div class="alert alert-warning alert-dismissible fade show" role="alert">\n                <strong>Error: </strong> '.concat(e.message,'\n                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n                </button>\n                </div>'))}})}),$(".analog-modal .modal-footer button").click(function(){var e=$(".analog-modal");$(this).hasClass("update")&&$("#updatemedia").submit(),e.removeClass("active")}),$("#image-upload-thumb-rm").click(function(){var a=$(this),e=a.data("id"),t=a.data("delajaxurl");if(!e||!t)return!1;$.ajax({type:"POST",url:t,data:{_id:e},success:function(e){a.remove(),$("input#_image").val(""),$(".image-upload-thumb.image-exists").css("background-image","none").addClass("no-image"),$(".image-upload-thumb.image-exists i").removeClass("d-none"),$(".custom-fields-notifications").append('<div class="alert alert-success alert-dismissible fade show" role="alert">\n                <strong>Success: </strong> '.concat(e.message,'\n                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n                </button>\n                </div>'))},error:function(e){console.error(e),$(".custom-fields-notifications").append('<div class="alert alert-warning alert-dismissible fade show" role="alert">\n                <strong>Error: </strong> '.concat(e.responseJSON.message,'\n                <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n                <span aria-hidden="true">&times;</span>\n                </button>\n                </div>'))}}).always(function(){$(".custom-fields-notifications .alert").remove()})}),$(".page-link.directional").click(function(e){e.preventDefault();var a=$(".page-item.active"),t=a.next(".page-item"),i=a.prev(".page-item");if($(this).hasClass("next"))return t.find("a.page-link").click(),!1;i.find("a.page-link").click()}),$("a.page-link").click(function(e){e.preventDefault();var a=$(this);if(!a.hasClass("directional")){var t=a.text(),i=new URLSearchParams(window.location.search);i.set("paged",t),window.location.search=i}}),$(".section-head").click(function(){var e=$(this).find(".section-toggle-controls");e.hasClass("expanded")?e.removeClass("expanded"):e.addClass("expanded")}),$(".add-item-overlay, .add-project-overlay").click(function(){var e=$(this);return e.hasClass("active")?e.removeClass("active"):e.addClass("active"),!1}),$(".mobile-menu-toggle").click(function(){return $("body").hasClass("mobile-menu-active")?$("body").removeClass("mobile-menu-active"):$("body").addClass("mobile-menu-active"),!1}),$(".listCheckbox.selectAll").click(function(){if($(".listCheckbox.selectAll:checked").length)return $("#list .listCheckbox.selectSingle:enabled").prop("checked",!0);$(".multi-edit-select-hidden").hide(),$("#list .listCheckbox.selectSingle:checked").prop("checked",!1)}),$(".listCheckbox").click(function(){if($("#list .listCheckbox.selectSingle:checked").length)return $("#multi-edit-select, #submit_list_multi_edit").prop("disabled",!1);$(".multi-edit-select-hidden").hide(),$("#multi-edit-select, #submit_list_multi_edit").prop("disabled",!0)}),$("#submit_list_multi_edit").click(function(){var e=$(this),a=e.data("posts"),t=[],i=e.data("url"),s=$("#multi-edit-select option:selected"),n=$(s.data("target")),l=$(n.data("supp")),d=s.val(),r=n.val(),o=l.val();e.prop("disabled",!0),$("#list .listCheckbox.selectSingle:checked").each(function(e,a){t.push($(a).val())});var c={list_id_arr:t,update_criteria:d,update_value:r,update_value_supp:o};a&&(c.are_posts=!0),$.ajax({type:"POST",url:i,data:c,success:function(){location.reload()},error:function(e){console.error(e),alert("An error occurred while bulk updating. Please try again.")}})}),$("#get_strong_pass").click(function(){var a=$(".password_target, .verify_password_target, .password_helper input");a.val(""),$.ajax({type:"GET",url:"/api/password",success:function(e){a.val(e),$(".password_helper").show()},error:function(e){console.error(e),alert("An error occurred while retrieving a strong password. Please try again later.")}})}),$("#multi-edit-select").change(function(){var e=$($(this).find(":selected").data("target"));$(".multi-edit-select-hidden").hide(),e.show()}),$("#paginationlimit").change(function(){var e=$(this).val(),a=window.location.href;if(0<=a.indexOf("limit="))return a=a.substring(0,a.indexOf("limit=")+"limit=".length),location.href="".concat(a).concat(e),!1;var t=-1!==a.indexOf("&")?"&limit=":"?limit=";location.href="".concat(a).concat(t).concat(e)}),$(".password_target, .verify_password_target").on("input",function(){$(".password_helper").hide()}),$("body").on("change",".repeater_form input[type=file]",function(){var e=$(this);e.siblings(".analog_media_select_input").val(""),e.siblings(".analog_media_select_img").attr("src","").hide(),e.siblings(".analog_media_select_remove").hide()});