"use strict";function sortable_bkg_color(e){var t=e.parent().closest(".list-group"),i=e.find(".list-group").first(),a=i.children(".list-group-item");return t.hasClass("contrast")||e.addClass("contrast"),a.length&&sortable_bkg_color(i),!1}function sortable_init(){var e=document.getElementsByClassName("list-group");$(".list-group.contrast").removeClass("contrast");for(var t=0;t<e.length;t++)new Sortable(e[t],{group:"nested",animation:150,fallbackOnBody:!0,swapThreshold:.5,onUpdate:sortable_update,onAdd:sortable_update}),t&&sortable_bkg_color($(e[t]))}function sortable_update(e){for(var t=$(e.item),i=t.attr("id"),a=$(e.to),s=a.children(".list-group-item"),n=a.closest(".list-group-item").attr("id"),r=[],o=[],l=0;l<s.length;l++){var d=$(s[l]),u=d.data("position"),m=d.attr("id");m&&r.push(m),u&&o.push(u)}if(!r||!o)return!1;$.ajax({type:"PUT",url:"/updatemenuitemposition",data:{_ids:r,positions:o,parent:n,moved_item_id:i},beforeSend:function(){t.find(".loader-dual-ring").show(),$(".menu.page button").prop("disabled",!0)},success:function(){},error:function(e){console.error(e),window.alert("An error occured while creating a menu item.")}}).always(function(){t.find(".loader-dual-ring").hide(),$(".menu.page button").prop("disabled",!1)})}$("body").on("click",".edit_menu_item",function(){var e=$(this),t=$("#edit_menu_item_modal").find("input, select"),i=e.closest(".list-group-item").data("permalink"),r={route:e.closest(".list-group-item-details").find(".list-group-item-route").text(),originalRoute:e.closest(".list-group-item-details").find(".list-group-item-route").text(),text:e.closest(".list-group-item-details").find(".list-group-item-text").text(),permalink:i,target:e.closest(".list-group-item").data("target"),reference:i?"true":"false",_id:e.closest(".list-group-item").attr("id")};t.each(function(e,t){var i=$(t),a=i.attr("name"),s=r[a];if("target"==a){var n="_blank"==r.target;i.prop("checked",n)}else i.val(s)})}),$(".menuitem_submit").click(function(){var e=$(this).closest(".form-wrap"),r=e.hasClass("add"),o=e.find("input, select"),n=!1,l={},t=r?"/addmenuitem":"/updatemenuitem";if(o.each(function(e,t){var i=$(t),a=i.attr("name"),s=i.val();if(!s&&i.prop("required"))return i.addClass("is-invalid"),!(n=!0);"target"==a&&(s=i.is(":checked")?"_blank":"_self"),l[a]=s}),n)return!1;o.removeClass("is-invalid"),$.ajax({type:"PUT",url:t,data:l,beforeSend:function(){$(".menu.page button").prop("disabled",!0)},success:function(e){var t=e.permalink?e.permalink._id:"";if(r){o.each(function(e,t){var i=$(t),a=i.attr("name");if("_id"==a||"reference"==a)return!0;i.val("").prop("checked",!1)});var i=e.is_ref?'<span class="badge badge-success">Reference</span>':'<span class="badge badge-secondary">Custom</span>',a='<li id="'+e._id+'" class="list-group-item" data-position="'+e.position+'" data-permalink="'+t+'" data-target="'+e.target+'"><div class="list-group-item-details"><div class="list-group-item-url"><div class="list-group-item-url"><span class="list-group-item-text">'+e.text+'</span> <span class="ml-4 mr-4"><strong>URL: </strong><span class="list-group-item-route">'+e.route+"</span></span>"+i+'</div></div><div class="list-group-item-actions"><button type="button" class="btn btn-info btn-sm edit_menu_item ml-4" data-toggle="modal" data-target="#edit_menu_item_modal">Edit</button><button type="button" class="btn btn-danger btn-sm del_menu_item ml-2">Delete</button></div></div><ul class="list-group mt-4"></ul></li>';$(".menu_items > div > .list-group").append(a),sortable_init()}else{var s=$("#"+l._id),n=s.find(".badge");s.find(".list-group-item-route").html(e.route),s.find(".list-group-item-text").html(e.text),s.data("target",e.target),s.data("permalink",t),n.removeClass("badge-success badge-secondary badge-danger").empty(),t?n.addClass("badge-success").html("Reference"):n.addClass("badge-secondary").html("Custom"),$("#edit_menu_item_modal").modal("toggle"),s.addClass("bg-success"),setTimeout(function(){s.removeClass("bg-success")},500)}},error:function(e){console.error(e),window.alert("An error occured while creating or updating a menu item.")}}).always(function(){$(".menu.page button").prop("disabled",!1)})}),$("body").on("click",".del_menu_item",function(){var e=$(this).closest(".list-group-item"),t=e.attr("id"),i=window.confirm("Are you sure you want to delete this menu item?");if(!t||!i)return!1;$.ajax({type:"DELETE",url:"/deletemenuitem",data:{_id:t},beforeSend:function(){$(".menu.page button").prop("disabled",!0)},success:function(){e.fadeOut().find(".list-group").first().children(".list-group-item").appendTo(".list-groups-wrap > .list-group"),e.remove(),sortable_init()},error:function(e){console.error(e),window.alert("An error occured while deleting a menu item.")}}).always(function(){$(".menu.page button").prop("disabled",!1)})}),$("#deletemenu").submit(function(e){if(!window.confirm("Are you sure you want to delete this menu?"))return!1}),$("#updatemenu").submit(function(e){if(!window.confirm("Updating the menu name will refresh this page and all other changes will be lost. Are you sure you want to continue?"))return!1}),$(".menu-item-url-select").change(function(){var e=$(this),t=e.find("option:selected").data("route"),i=e.find("option:selected").data("title"),a=e.closest("form").find(".addmenuitem-text"),s=e.closest("form").find(".addmenuitem-url"),n=e.closest("form").find(".addmenuitem-ref"),r=e.closest("form").find(".addmenuitem-or");a.val(i),s.val(t),r.val(t),n.val("true")}),sortable_init();